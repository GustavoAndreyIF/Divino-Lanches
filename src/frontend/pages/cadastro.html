<main class="flex-fill">
    <div class="container">
        <h1>Informe seus dados, por favor</h1>
        <hr />
        <form class="mt-3" id="registerForm" action="/Registrar" method="POST">
            <div class="row">
                <div class="col-sm-12 col-md-6">
                    <fieldset class="row gx-3">
                        <legend>Dados Pessoais</legend>
                        <div class="form-floating mb-3">
                            <input class="form-control" type="text" id="txtNome" placeholder=" " name="nm_cliente" required />
                            <label for="txtNome">Nome</label>
                        </div>
                        <div class="form-floating mb-3 col-md-6 col-xl-4">
                            <input class="form-control" type="text" id="txtCPF" placeholder=" " />
                            <label for="txtCPF">CPF</label>
                        </div>
                    </fieldset>
                    <fieldset>
                        <legend>Contatos</legend>
                        <div class="form-floating mb-3 col-md-8">
                            <input class="form-control" type="email" id="txtEmail" placeholder=" " name="cliente_email" required />
                            <label for="txtEmail">E-mail</label>
                        </div>
                        <div class="form-floating mb-3 col-md-6">
                            <input class="form-control" placeholder=" " type="text" id="txtTelefone" />
                            <label for="txtTelefone">Telefone</label>
                        </div>
                    </fieldset>
                </div>
                <div class="col-sm-12 col-md-6">
                    <fieldset class="row gx-3">
                        <legend>Senha de Acesso</legend>
                        <div class="form-floating mb-3 col-lg-6">
                            <input class="form-control" type="password" id="txtSenha" placeholder=" " name="cliente_log_senha" required />
                            <label for="txtSenha">Senha</label>
                        </div>
                        <div class="form-floating mb-3 col-lg-6">
                            <input class="form-control" type="password" id="txtConfirmacaoSenha" placeholder=" " required />
                            <label class="form-label" for="txtConfirmacaoSenha">Confirmação da Senha</label>
                        </div>
                    </fieldset>
                </div>
            </div>
            <hr />
            <div class="form-check mb-3">
                <input class="form-check-input" type="checkbox" value="" id="flexCheckDefault" />
                <label class="form-check-label" for="flexCheckDefault">Desejo receber informações sobre promoções.</label>
            </div>
            <div class="mb-3 text-left">
                <a class="btn btn-lg btn-light btn-outline-danger" href="/">Cancelar</a>
                <button type="submit" class="btn btn-lg btn-warning" id="btnRegister">Criar meu cadastro</button>
            </div>
        </form>
    </div>
</main>

<script type="module">
    import { AuthController } from "../controllers/authController.js";

    document.addEventListener("DOMContentLoaded", () => {
        setTimeout(() => {
            document.getElementById("txtNome").focus();
        }, 0);
    });

    document.getElementById("registerForm").addEventListener("submit", async (event) => {
        event.preventDefault(); // Impede o envio padrão do formulário

        const name = document.getElementById("txtNome").value;
        const email = document.getElementById("txtEmail").value;
        const password = document.getElementById("txtSenha").value;
        const confirmPassword = document.getElementById("txtConfirmacaoSenha").value;

        // Validação do email
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!emailRegex.test(email)) {
            alert("Por favor, insira um email válido.");
            return;
        }

        // Validação da senha
        if (password.length < 8) {
            alert("A senha deve ter no mínimo 8 caracteres.");
            return;
        }

        // Validação do nome
        if (name.length > 256) {
            alert("O nome deve ter no máximo 256 caracteres.");
            return;
        }

        if (password !== confirmPassword) {
            alert("As senhas não coincidem.");
            return;
        }

        const authController = new AuthController();
        try {
            await authController.handleRegister(email, password, name);
        } catch (error) {
            console.error('Erro ao registrar:', error);
            alert('Erro ao registrar. Por favor, tente novamente.');
        }
    });
</script>